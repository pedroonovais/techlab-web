<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: head('Motos')}"></head>

<body class="bg-gray-900 text-white min-h-screen flex flex-col font-sans">
    <!-- Header -->
    <nav th:replace="~{fragments/header :: navbar}"></nav>

    <main class="flex-1 mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
        <!-- Título + Ações -->
        <section class="mb-4 flex items-center justify-between gap-3">
            <h1 class="text-2xl font-bold">Motos</h1>
            <a href="/moto/form"
                class="bg-green-600 hover:bg-green-700 text-gray-900 px-4 py-2 rounded-md font-semibold transition-colors">
                + Nova Moto
            </a>
        </section>

        <!-- Mensagem -->
        <div th:if="${message}" class="rounded-lg border border-cyan-700 bg-cyan-900/40 text-cyan-200 px-4 py-3 mb-4"
            th:text="${message}">
        </div>

        <!-- Filtros (client-side) -->
        <section class="mb-4 flex flex-col sm:flex-row gap-3">
            <input id="filterModelo" type="text" placeholder="Filtrar por modelo..." class="w-full sm:w-80 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white
                    focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
            <input id="filterPlaca" type="text" placeholder="Filtrar por placa..." class="w-full sm:w-60 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white
                    focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
        </section>

        <!-- Tabela -->
        <section class="rounded-xl bg-gray-800 border border-gray-700 shadow-2xl overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead>
                    <tr class="text-left text-gray-400">
                        <th class="py-2 px-3">ID</th>
                        <th class="py-2 px-3">Modelo</th>
                        <th class="py-2 px-3">Placa</th>
                        <th class="py-2 px-3">Data Entrada</th>
                        <th class="py-2 px-3">Data Saída</th>
                        <th class="py-2 px-3">Ações</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                    <tr th:if="${#lists.isEmpty(motos)}">
                        <td colspan="6" class="py-4 text-center text-gray-400">Nenhuma moto cadastrada</td>
                    </tr>

                    <tr th:each="m : ${motos}" class="hover:bg-gray-700/40">
                        <td class="py-2 px-3" th:text="${m.id}">—</td>
                        <td class="py-2 px-3 moto-modelo" th:text="${m.modelo}">—</td>
                        <td class="py-2 px-3 moto-placa" th:text="${m.placa}">—</td>
                        <td class="py-2 px-3" th:text="${#temporals.format(m.dataEntrada, 'dd/MM/yyyy HH:mm')}">—</td>
                        <td class="py-2 px-3"
                            th:text="${m.dataSaida != null ? #temporals.format(m.dataSaida, 'dd/MM/yyyy HH:mm') : '—'}">
                            —</td>
                        <td class="py-2 px-3">
                            <div class="flex flex-wrap gap-2">
                                <!-- Editar -->
                                <a th:href="@{'/moto/' + ${m.id} + '/edit'}" class="bg-gray-700 hover:bg-cyan-600/20 text-white border border-cyan-500
                          px-3 py-1.5 rounded-md transition-colors text-xs">
                                    Editar
                                </a>

                                <!-- Excluir (POST /moto/{id}/delete) -->
                                <form th:action="@{'/moto/' + ${m.id} + '/delete'}" method="post"
                                    onsubmit="return confirm('Tem certeza que deseja remover esta moto?');">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                    <button type="submit"
                                        class="bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-md transition-colors text-xs">
                                        Excluir
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <!-- Filtro local (modelo/placa) -->
    <script>
        const fm = document.getElementById('filterModelo');
        const fp = document.getElementById('filterPlaca');

        function rows() {
            return Array.from(document.querySelectorAll('tbody tr'))
                .filter(r => !r.querySelector('td[colspan]')); // ignora linha "Nenhuma moto..."
        }

        function applyFilter() {
            const qModelo = (fm.value || '').toLowerCase();
            const qPlaca = (fp.value || '').toLowerCase();

            rows().forEach(tr => {
                const modelo = tr.querySelector('.moto-modelo')?.textContent?.toLowerCase() || '';
                const placa = tr.querySelector('.moto-placa')?.textContent?.toLowerCase() || '';
                const ok = (modelo.includes(qModelo)) && (placa.includes(qPlaca));
                tr.style.display = ok ? '' : 'none';
            });
        }

        fm?.addEventListener('input', applyFilter);
        fp?.addEventListener('input', applyFilter);
    </script>
</body>

</html>